

-- Tabla de Usuarios
CREATE TABLE Usuarios (
    id_usuario INTEGER PRIMARY KEY AUTOINCREMENT,
    nombre_usuario TEXT NOT NULL,
    clave TEXT NOT NULL,
    tipo_usuario TEXT CHECK(tipo_usuario IN ('admin', 'empleado')) NOT NULL,
    estado TEXT CHECK(estado IN ('activo', 'inactivo')) NOT NULL DEFAULT 'activo'
);

-- Tabla de Mesas
CREATE TABLE Mesas (
    id_mesa INTEGER PRIMARY KEY AUTOINCREMENT,
    numero_mesa INTEGER NOT NULL,
    capacidad INTEGER NOT NULL,
    estado TEXT CHECK(estado IN ('disponible', 'ocupada', 'reservada')) NOT NULL DEFAULT 'disponible'
);

-- Tabla de Men√∫
CREATE TABLE Menu (
    id_menu INTEGER PRIMARY KEY AUTOINCREMENT,
    nombre_plato TEXT NOT NULL,
    descripcion TEXT,
    precio REAL NOT NULL,
    disponible INTEGER NOT NULL DEFAULT 1 -- 1: disponible, 0: no disponible
);

-- Tabla de Pedidos
CREATE TABLE Pedidos (
    id_pedido INTEGER PRIMARY KEY AUTOINCREMENT,
    id_usuario INTEGER,
    id_mesa INTEGER,
    fecha_pedido DATETIME NOT NULL,
    total REAL NOT NULL,
    estado TEXT CHECK(estado IN ('pendiente', 'preparando', 'servido', 'pagado')) NOT NULL DEFAULT 'pendiente',
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(id_usuario),
    FOREIGN KEY (id_mesa) REFERENCES Mesas(id_mesa)
);

-- Tabla de Detalles de Pedido
CREATE TABLE DetallesPedido (
    id_detalle INTEGER PRIMARY KEY AUTOINCREMENT,
    id_pedido INTEGER,
    id_menu INTEGER,
    cantidad INTEGER NOT NULL,
    precio_unitario REAL NOT NULL,
    subtotal REAL NOT NULL,
    FOREIGN KEY (id_pedido) REFERENCES Pedidos(id_pedido),
    FOREIGN KEY (id_menu) REFERENCES Menu(id_menu)
);

-- Tabla de Reservas
CREATE TABLE Reservas (
    id_reserva INTEGER PRIMARY KEY AUTOINCREMENT,
    id_usuario INTEGER,
    id_mesa INTEGER,
    fecha_reserva DATETIME NOT NULL,
    nombre_cliente TEXT NOT NULL,
    telefono_cliente TEXT,
    estado TEXT CHECK(estado IN ('pendiente', 'confirmada', 'cancelada')) NOT NULL DEFAULT 'pendiente',
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(id_usuario),
    FOREIGN KEY (id_mesa) REFERENCES Mesas(id_mesa)
);

-- Tabla de Pagos
CREATE TABLE Pagos (
    id_pago INTEGER PRIMARY KEY AUTOINCREMENT,
    id_pedido INTEGER,
    fecha_pago DATETIME NOT NULL,
    monto REAL NOT NULL,
    metodo_pago TEXT CHECK(metodo_pago IN ('efectivo', 'tarjeta', 'transferencia')) NOT NULL,
    FOREIGN KEY (id_pedido) REFERENCES Pedidos(id_pedido)
);

-- Tabla de Inventario
CREATE TABLE Inventario (
    id_inventario INTEGER PRIMARY KEY AUTOINCREMENT,
    nombre_producto TEXT NOT NULL,
    cantidad_actual INTEGER NOT NULL,
    cantidad_minima INTEGER NOT NULL,
    unidad_medida TEXT NOT NULL
);

-- Tabla de Proveedores
CREATE TABLE Proveedores (
    id_proveedor INTEGER PRIMARY KEY AUTOINCREMENT,
    nombre_proveedor TEXT NOT NULL,
    contacto TEXT,
    telefono TEXT,
    email TEXT
);

-- Tabla de Compras
CREATE TABLE Compras (
    id_compra INTEGER PRIMARY KEY AUTOINCREMENT,
    id_proveedor INTEGER,
    fecha_compra DATETIME NOT NULL,
    total REAL NOT NULL,
    FOREIGN KEY (id_proveedor) REFERENCES Proveedores(id_proveedor)
);

-- Tabla de Detalles de Compra
CREATE TABLE DetallesCompra (
    id_detalle_compra INTEGER PRIMARY KEY AUTOINCREMENT,
    id_compra INTEGER,
    id_inventario INTEGER,
    cantidad INTEGER NOT NULL,
    precio_unitario REAL NOT NULL,
    subtotal REAL NOT NULL,
    FOREIGN KEY (id_compra) REFERENCES Compras(id_compra),
    FOREIGN KEY (id_inventario) REFERENCES Inventario(id_inventario)
);
